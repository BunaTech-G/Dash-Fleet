<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Connexion - DashFleet</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    /* Small overrides to centre the auth card */
    .auth-wrap { min-height: 100vh; display:flex; align-items:center; justify-content:center; padding:40px; }
    .auth-card { width:420px; max-width:96%; padding:28px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid var(--border); box-shadow:var(--shadow); }
    .auth-card h2 { margin:0 0 8px; font-size:22px }
    .auth-hint { color:var(--muted); margin-bottom:14px }
    .auth-field { margin-bottom:12px }
    .auth-input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.02); color:var(--text); }
    .auth-btn { margin-top:8px; width:100%; padding:10px; border-radius:10px; border:none; background:var(--accent); color:#04263a; font-weight:700; cursor:pointer }
    .auth-error { margin-top:10px; color:#ffb4b4; font-weight:600 }
    .small { font-size:13px; color:var(--muted); margin-top:8px }
  </style>
</head>
<body class="">
  <div class="page auth-wrap">
    <div class="auth-card">
      <div class="header">
        <div class="eyebrow">Tableau de bord système</div>
        <h2>Connexion</h2>
      </div>
      <p class="auth-hint">Entrez une clé API valide pour afficher le tableau de bord.</p>

      <div class="auth-field">
        <label for="api_key" class="label">Clé API</label>
        <input id="api_key" class="auth-input" type="text" placeholder="xxxx..." autocomplete="off" />
      </div>

      <button id="login" class="auth-btn">Se connecter</button>
      <div id="msg" class="auth-error" aria-live="polite"></div>
      <div class="small">Vous pouvez créer une clé via l'admin si vous disposez d'un `ACTION_TOKEN`.</div>
    </div>
  </div>

  <script>
    async function doLogin() {
      const key = document.getElementById('api_key').value.trim();
      const msg = document.getElementById('msg');
      msg.textContent = '';
      if (!key) { msg.textContent = 'La clé API est requise.'; return }
      try {
        const resp = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ api_key: key })
        });
        const data = await resp.json();
        if (!resp.ok) {
          msg.textContent = data.error || 'Impossible de se connecter';
          return
        }
        // session cookie set by server; redirect to root
        window.location.replace('/');
      } catch (err) {
        msg.textContent = 'Erreur réseau.';
      }
    }
    document.getElementById('login').addEventListener('click', doLogin);
    document.getElementById('api_key').addEventListener('keydown', (e)=>{ if(e.key==='Enter') doLogin() });
  </script>
</body>
</html>
