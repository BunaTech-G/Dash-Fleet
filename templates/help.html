<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aide & Documentation - DashFleet</title>
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/i18n.js"></script>
  <style>
    .help-container { max-width: 1200px; margin: 0 auto; padding: 56px 20px 72px; }
    .help-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }
    .help-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--card-radius); padding: 24px; box-shadow: var(--shadow); transition: transform 0.2s, box-shadow 0.2s; }
    .help-card:hover { transform: translateY(-2px); box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4); }
    .help-card h3 { margin: 0 0 12px 0; font-size: 18px; color: var(--text); }
    .help-card .label { display: inline-block; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-bottom: 8px; }
    .help-card p { margin: 12px 0; color: var(--muted); line-height: 1.6; }
    .help-card ul { margin: 12px 0; padding-left: 20px; }
    .help-card li { margin: 8px 0; color: var(--muted); }
    .code-block { background: var(--panel-strong); border-left: 3px solid var(--accent); padding: 12px 16px; border-radius: 4px; font-family: 'Monaco', 'Courier New', monospace; font-size: 12px; color: var(--text); overflow-x: auto; margin: 12px 0; }
    .callout { background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(34, 197, 94, 0.1)); border-left: 4px solid var(--success); padding: 14px 16px; border-radius: 6px; margin: 16px 0; color: var(--text); }
    .callout.warning { border-left-color: var(--warn); background: linear-gradient(135deg, rgba(250, 204, 21, 0.1), rgba(250, 204, 21, 0.05)); }
    .callout.critical { border-left-color: var(--critical); background: linear-gradient(135deg, rgba(244, 63, 94, 0.1), rgba(244, 63, 94, 0.05)); }
    .metric-desc { display: grid; grid-template-columns: 150px 1fr; gap: 16px; margin: 12px 0; }
    .metric-desc dt { font-weight: 600; color: var(--accent); }
    .metric-desc dd { margin: 0; color: var(--muted); }
    .breadcrumb { display: flex; gap: 8px; margin: 20px 0; font-size: 13px; color: var(--muted); }
    .breadcrumb a { color: var(--accent); text-decoration: none; }
    .breadcrumb a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="help-container">
    <header style="margin-bottom:30px;">
      <div>
        <p class="eyebrow">DOCUMENTATION</p>
        <h1 style="margin:6px 0 4px;">Aide & Guide d'Utilisation</h1>
        <p class="lede">Tout ce qu'il faut savoir pour g√©rer efficacement votre flotte avec DashFleet.</p>
      </div>
      <div class="header-actions">
        <div class="lang-switch">
          <label for="lang-select" id="lang-label">Langue</label>
          <select id="lang-select" class="lang-select">
            <option value="fr">FR</option>
            <option value="en">EN</option>
            <option value="es">ES</option>
            <option value="ru">RU</option>
          </select>
        </div>
        <button class="theme-toggle" id="theme-toggle" aria-label="Changer le th√®me clair/sombre" tabindex="1">Mode sombre</button>
      </div>
    </header>

    <nav class="nav-links">
      <a href="/">Temps r√©el</a>
      <a href="/history">Historique</a>
      <a href="/fleet">Fleet</a>
      <a href="/help" class="active">Aide</a>
    </nav>

    <!-- SECTION 1: NAVIGATION -->
    <section style="margin-top: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">üìç Navigation G√©n√©rale</h2>
      <div class="help-grid">
        <article class="help-card">
          <div class="label">Temps R√©el</div>
          <h3>Statut Local & Rapide</h3>
          <p>Affiche les m√©triques syst√®me de votre machine actuelle (CPU, RAM, Disque). Permet d'acc√©der rapidement aux actions locales sans configurer d'agent.</p>
          <ul>
            <li>Graphiques temps r√©el</li>
            <li>Sant√© syst√®me instantan√©e</li>
            <li>Actions locales rapides</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Historique</div>
          <h3>Tendances & Analyse</h3>
          <p>Visualisez les courbes historiques de CPU, RAM et Disque avec zoom et s√©lection temporelle. Identifiez les goulots et les anomalies.</p>
          <ul>
            <li>Graphiques sur 24h/7j/30j</li>
            <li>Export des donn√©es</li>
            <li>D√©tection de pics</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Fleet</div>
          <h3>G√©rer la Flotte</h3>
          <p>Vue centrale de tous les postes report√©s par les agents. Visualisez la sant√© collective, filtrez par statut, et envoyez des actions √† distance.</p>
          <ul>
            <li>Tableau des machines</li>
            <li>Badges de sant√© (ok/warn/critical)</li>
            <li>Actions distance (messages, red√©marrage)</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Admin</div>
          <h3>Gestion Organisationnelle</h3>
          <p>R√©serv√© aux administrateurs. G√©rez les organisations, les cl√©s API, les tokens d'action et les configurations globales.</p>
          <ul>
            <li>Cr√©er/supprimer organisations</li>
            <li>G√©n√©rer cl√©s API</li>
            <li>Configurer secrets</li>
          </ul>
        </article>
      </div>
    </section>

    <!-- SECTION 2: M√âTRIQUES -->
    <section style="margin-top: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">üìä Comprendre les M√©triques</h2>
      
      <div class="callout">
        <strong>‚úì Source fiable :</strong> Toutes les m√©triques proviennent directement de l'OS via les <strong>gestionnaires de t√¢ches syst√®me</strong> (Windows Task Manager, Linux htop, macOS Activity Monitor). Les donn√©es sont collect√©es toutes les 10 secondes par l'agent en utilisant la biblioth√®que <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">psutil</code> qui acc√®de aux donn√©es brutes du kernel syst√®me.
      </div>

      <div class="help-grid">
        <article class="help-card">
          <div class="label">CPU</div>
          <h3>Utilisation du Processeur</h3>
          <p>Pourcentage moyen d'utilisation du CPU (0-100%). √âchantillonn√© sur 0.3s pour une mesure pr√©cise via les interruptions syst√®me.</p>
          <div class="code-block">Seuil sant√©:<br/>&lt;50%: ‚úÖ OK<br/>50-80%: ‚ö†Ô∏è Avertissement<br/>&gt;80%: üî¥ Critique</div>
        </article>

        <article class="help-card">
          <div class="label">RAM</div>
          <h3>M√©moire Utilis√©e</h3>
          <p>Pourcentage d'utilisation de la m√©moire vive. Inclut les buffers du syst√®me, le cache et la m√©moire active.</p>
          <div class="code-block">Seuil sant√©:<br/>&lt;60%: ‚úÖ OK<br/>60-85%: ‚ö†Ô∏è Avertissement<br/>&gt;85%: üî¥ Critique</div>
        </article>

        <article class="help-card">
          <div class="label">Disque</div>
          <h3>Espace de Stockage</h3>
          <p>Pourcentage d'utilisation du disque syst√®me (lecteur racine). Mesure l'espace libre disponible pour le syst√®me.</p>
          <div class="code-block">Seuil sant√©:<br/>&lt;70%: ‚úÖ OK<br/>70-90%: ‚ö†Ô∏è Avertissement<br/>&gt;90%: üî¥ Critique</div>
        </article>

        <article class="help-card">
          <div class="label">Sant√©</div>
          <h3>Score Agr√©g√© (0-100)</h3>
          <p>Score pond√©r√© combinant CPU (35%), RAM (35%) et Disque (30%). Calcul lin√©aire du d√©passement des seuils.</p>
          <div class="code-block">‚â•80: ‚úÖ OK<br/>‚â•60: ‚ö†Ô∏è Avertissement<br/>&lt;60: üî¥ Critique</div>
        </article>
      </div>

      <div style="background: var(--panel); border: 1px solid var(--border); border-radius: var(--card-radius); padding: 20px; margin-top: 20px;">
        <h3 style="margin-top: 0;">M√©tadonn√©es Syst√®me</h3>
        <p style="color: var(--muted);">Chaque machine reporte aussi (depuis le gestionnaire syst√®me):</p>
        <div class="metric-desc">
          <dt>üñ•Ô∏è OS</dt><dd>Syst√®me d'exploitation (Windows, Linux, macOS)</dd>
          <dt>‚è±Ô∏è Uptime</dt><dd>Temps √©coul√© depuis le dernier red√©marrage (en secondes et format lisible)</dd>
          <dt>üêç Python</dt><dd>Version de l'interpr√©teur Python de l'agent</dd>
          <dt>üì¶ Architecture</dt><dd>Type de processeur (x86_64, ARM64, etc.)</dd>
          <dt>üîë Hardware ID</dt><dd>Identifiant physique unique de la machine (adresse MAC)</dd>
        </div>
      </div>
    </section>

    <!-- SECTION 3: ACTIONS DISTANCE -->
    <section style="margin-top: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">üöÄ Actions Distance</h2>
      
      <div class="callout warning">
        <strong>‚ö†Ô∏è Attention :</strong> Les actions distance sont ex√©cut√©es imm√©diatement sur la machine cible. Utilisez-les avec prudence, surtout pour les red√©marrages et arr√™ts.
      </div>

      <div class="help-grid">
        <article class="help-card">
          <div class="label">Message</div>
          <h3>Afficher une Notification</h3>
          <p>Envoie une fen√™tre de message (MessageBox) directement sur l'√©cran de la machine. Utile pour communiquer rapidement avec les utilisateurs.</p>
          <ul>
            <li>‚úì Support multi-OS (Windows, Linux, macOS)</li>
            <li>‚úì Titre et message personnalisables</li>
            <li>‚úì Ex√©cution imm√©diate (toutes les 30s)</li>
            <li>‚úì Appara√Æt en avant-plan</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Red√©marrage</div>
          <h3>Restart la Machine</h3>
          <p>Initie un red√©marrage ordonnanc√© de la machine avec un d√©lai (60s sur Windows, 1min sur Linux/macOS).</p>
          <ul>
            <li>‚úì D√©lai d'attente programm√© (permet sauvegarde des donn√©es)</li>
            <li>‚úì Log du red√©marrage dans syst√®me</li>
            <li>‚úì Ex√©cution avec privil√®ges administrateur</li>
            <li>‚úì Id√©al post-maintenance ou pour appliquer des correctifs</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Arr√™t</div>
          <h3>√âteindre la Machine</h3>
          <p>Proc√®de √† l'arr√™t complet de la machine (shutdown). Utilisez avec extr√™me prudence en production.</p>
          <ul>
            <li>‚ö†Ô∏è Attention: perte de travail non sauvegard√©</li>
            <li>‚úì D√©lai avant fermeture</li>
            <li>‚úì Notification pr√©alable</li>
            <li>‚úì √Ä √©viter en heures de travail</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Flux Technique</div>
          <h3>Comment Fonctionnent les Actions?</h3>
          <p style="margin-bottom: 12px;"><strong>1.</strong> Vous cliquez "üì® Actions" sur une machine<br/>
          <strong>2.</strong> Le serveur met l'action en base de donn√©es<br/>
          <strong>3.</strong> L'agent interroge toutes les 30s<br/>
          <strong>4.</strong> L'agent ex√©cute localement (avec privil√®ges)<br/>
          <strong>5.</strong> R√©sultat remont√© au serveur et enregistr√©</p>
        </article>
      </div>
    </section>

    <!-- SECTION 4: INSTALLATION AGENT -->
    <section style="margin-top: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">üîß Installation Agent</h2>
      
      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">Pr√©requis</div>
        <h3>Avant de Commencer</h3>
        <ul>
          <li><strong>‚úì Python 3.8+</strong> install√© sur la machine</li>
          <li><strong>‚úì Cl√© API</strong> g√©n√©r√©e depuis l'Admin</li>
          <li><strong>‚úì Acc√®s r√©seau</strong> vers le serveur DashFleet (HTTPS)</li>
          <li><strong>‚úì Permissions</strong> pour installer les packages Python</li>
          <li><strong>‚úì psutil</strong> package (pour les m√©triques syst√®me)</li>
        </ul>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">Configuration</div>
        <h3>Fichier config.json</h3>
        <p>Cr√©ez un fichier <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">config.json</code> dans le r√©pertoire agent avec:</p>
        <div class="code-block">{
  "server": "https://dashfleet.example.com",
  "token": "api_votre_cle_ici",
  "interval": 10,
  "machine_id": "hostname",
  "log_file": "logs/agent.log"
}</div>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">Lancement</div>
        <h3>D√©marrer l'Agent</h3>
        <p>Depuis le r√©pertoire de l'agent:</p>
        <div class="code-block">pip install psutil requests
python fleet_agent.py --token api_xxx --server https://dashfleet.example.com</div>
        <p style="margin-top: 12px; color: var(--muted);">L'agent doit rester actif en continu. Utilisez un service systemd (Linux) ou une t√¢che planifi√©e (Windows) pour le d√©marrage automatique.</p>
      </article>
    </section>

    <!-- SECTION 5: S√âCURIT√â -->
    <section style="margin-top: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">üîê S√©curit√© & Bonnes Pratiques</h2>
      
      <div class="callout critical">
        <strong>üîí Important :</strong> Les cl√©s API sont des secrets sensibles. Prot√©gez-les comme des mots de passe!
      </div>

      <div class="help-grid">
        <article class="help-card">
          <div class="label">Cl√©s API</div>
          <h3>Gestion des Credentials</h3>
          <ul>
            <li>‚úì G√©n√©rez des cl√©s uniques par organisation</li>
            <li>‚úì R√©voquez les cl√©s compromises imm√©diatement</li>
            <li>‚úì Stockez dans des variables d'env ou fichiers s√©curis√©s (chmod 600)</li>
            <li>‚úì Ne committez jamais les cl√©s sur Git</li>
            <li>‚úì Changez r√©guli√®rement (tous les 90 jours)</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Transport</div>
          <h3>Communication S√©curis√©e</h3>
          <ul>
            <li>‚úì Utilisez HTTPS/TLS 1.3 en production</li>
            <li>‚úì Certificats SSL valides</li>
            <li>‚úì Authentification Bearer Token sur chaque requ√™te</li>
            <li>‚úì Rate limiting: 30 req/min max par agent</li>
            <li>‚úì Timeout: 5 secondes par requ√™te</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Donn√©es</div>
          <h3>Protection des Informations</h3>
          <ul>
            <li>‚úì Les m√©triques ne contiennent pas d'infos sensibles</li>
            <li>‚úì Aucun mot de passe ou cl√© envoy√©</li>
            <li>‚úì Donn√©es chiffr√©es en transit (HTTPS)</li>
            <li>‚úì TTL: donn√©es machines supprim√©es apr√®s 10 min d'inactivit√©</li>
          </ul>
        </article>

        <article class="help-card">
          <div class="label">Admin</div>
          <h3>Contr√¥le d'Acc√®s</h3>
          <ul>
            <li>‚úì Interface Admin prot√©g√©e par authentification</li>
            <li>‚úì Sessions s√©curis√©es avec tokens</li>
            <li>‚úì Audit des actions administrateur</li>
            <li>‚úì Logs d√©taill√©s conserv√©s 90 jours</li>
          </ul>
        </article>
      </div>
    </section>

    <!-- SECTION 6: TROUBLESHOOTING -->
    <section style="margin-top: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">üêõ D√©pannage</h2>

      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">Agent Offline</div>
        <h3>Pourquoi ma machine n'appara√Æt pas dans Fleet?</h3>
        <ul>
          <li>‚úì V√©rifiez que l'agent est lanc√©: <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">python fleet_agent.py</code></li>
          <li>‚úì V√©rifiez la cl√© API: <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">--token api_xxx</code></li>
          <li>‚úì V√©rifiez la connexion r√©seau vers le serveur (ping test)</li>
          <li>‚úì Consultez les logs: <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">logs/agent.log</code></li>
          <li>‚úì Attendez 30 secondes (d√©lai de la premi√®re requ√™te)</li>
        </ul>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">Connexion √âchou√©e</div>
        <h3>Erreur "HTTPError 403" ou "Unauthorized"?</h3>
        <ul>
          <li>‚úì La cl√© API est expir√©e ou invalide</li>
          <li>‚úì L'organisation associ√©e est d√©sactiv√©e</li>
          <li>‚úì Le token Bearer n'est pas envoy√© correctement</li>
          <li>‚úì R√©g√©n√©rez une nouvelle cl√© depuis Admin</li>
        </ul>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">M√©triques Aberrantes</div>
        <h3>CPU/RAM affiche 0% ou 100%?</h3>
        <ul>
          <li>‚úì Red√©marrez l'agent (fermer et relancer)</li>
          <li>‚úì V√©rifiez que psutil est install√©: <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">pip list | grep psutil</code></li>
          <li>‚úì V√©rifiez les permissions syst√®me (surtout Linux, besoin de droits lecture /proc)</li>
          <li>‚úì Les m√©triques peuvent avoir un d√©lai de 10-30s avant affichage</li>
        </ul>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <div class="label">Contact Support</div>
        <h3>Autre Probl√®me?</h3>
        <p>Rassemblez les informations suivantes et contactez l'administrateur:</p>
        <ul>
          <li>üìã Version de l'agent et du serveur</li>
          <li>üìã Logs complets (agent + serveur)</li>
          <li>üìã Configuration utilis√©e (sans cl√©s sensibles)</li>
          <li>üìã Description du probl√®me et √©tapes pour reproduire</li>
          <li>üìã Environnement (OS, Python version, architecture)</li>
        </ul>
      </article>
    </section>

    <!-- SECTION 7: FAQ -->
    <section style="margin-top: 40px; margin-bottom: 40px;">
      <h2 style="margin: 0 0 24px 0; font-size: 24px; color: var(--text);">‚ùì Questions Fr√©quentes</h2>

      <article class="help-card" style="grid-column: 1/-1;">
        <h3 style="margin-top: 0;">√Ä quelle fr√©quence les donn√©es sont-elles collect√©es?</h3>
        <p>Toutes les 10 secondes par d√©faut. Configurable via le param√®tre <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">--interval</code>. Les actions sont interrog√©es toutes les 30 secondes.</p>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <h3 style="margin-top: 0;">Combien de temps les donn√©es sont conserv√©es?</h3>
        <p>Les donn√©es en temps r√©el: 10 minutes (TTL). Les donn√©es historiques sont conserv√©es ind√©finiment selon votre contrat. Archivage mensuel disponible.</p>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <h3 style="margin-top: 0;">Les actions peuvent-elles √™tre annul√©es?</h3>
        <p>Non, une fois ex√©cut√©e par l'agent, une action est d√©finitive. Planifiez les red√©marrages √† l'avance et testez sur une machine de d√©veloppement.</p>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <h3 style="margin-top: 0;">Puis-je avoir plusieurs organisations?</h3>
        <p>Oui, chaque organisation est compl√®tement isol√©e avec ses propres cl√©s API, machines et donn√©es. Les donn√©es ne sont jamais partag√©es entre orgs.</p>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <h3 style="margin-top: 0;">Quelle est la charge CPU de l'agent?</h3>
        <p>Tr√®s l√©g√®re (~0.3s de CPU par cycle de 10s de donn√©es). L'agent est con√ßu pour tourner continuellement sans impacter les performances syst√®me.</p>
      </article>

      <article class="help-card" style="grid-column: 1/-1;">
        <h3 style="margin-top: 0;">D'o√π proviennent exactement les m√©triques?</h3>
        <p>Les m√©triques sont collect√©es directement depuis le syst√®me d'exploitation via la biblioth√®que Python <code style="background: var(--panel-strong); padding: 2px 6px; border-radius: 3px;">psutil</code>, qui acc√®de aux donn√©es du gestionnaire de t√¢ches syst√®me. Aucune estimation ou calcul approximatif.</p>
      </article>
    </section>
  </div>

  <script>
    const langSelect = document.getElementById('lang-select');
    const themeToggle = document.getElementById('theme-toggle');
    let t = dashboardI18n.get();
    let theme = localStorage.getItem('theme') === 'light' ? 'light' : 'dark';

    function updateThemeButton() {
      if (!themeToggle) return;
      themeToggle.textContent = theme === 'dark' ? (t.themeLight || 'Mode clair') : (t.themeDark || 'Mode sombre');
    }

    function setTheme(nextTheme) {
      theme = nextTheme === 'light' ? 'light' : 'dark';
      document.body.classList.toggle('light', theme === 'light');
      localStorage.setItem('theme', theme);
      updateThemeButton();
    }

    function applyStaticTexts() {
      document.getElementById('lang-label').textContent = t.langLabel || 'Langue';
    }

    dashboardI18n.bindSelect(langSelect);
    dashboardI18n.subscribe((lang, nextT) => {
      t = nextT;
      if (langSelect) langSelect.value = lang;
      applyStaticTexts();
      updateThemeButton();
    });

    if (themeToggle) {
      themeToggle.addEventListener('click', () => setTheme(theme === 'dark' ? 'light' : 'dark'));
    }

    setTheme(theme);
    applyStaticTexts();
    updateThemeButton();
  </script>
</body>
</html>
